<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>1418 TuningPage</title>
    <link rel="stylesheet" href="style.css">
    <script src="js/jquery.js"></script>
    <script src="js/d3.js"></script>
    <script src="/networktables/networktables.js"></script>
</head>

<body>
    <header>
        Robot:
        <span id="robotstate">Unknown state</span>
        <nav>
            <ul>
                <li><a href="UI_MainPage.html">Teleop</a></li>
                <li class="active"><a href="tuningPage.html">Tuning</a></li>
                <li><a href="autonomousSelection.html">Autonomous</a></li>
            </ul>
        </nav>
    </header>

    <article>
        <form>
            <input type="text" placeholder="Name" name="name" id="name">
            <input type="text" placeholder="Value" name="value" id="value">
        </form>
        <button id="setButton">Set</button>
        <button id="get">Get</button>
        <h1>Dashboard</h1>
        <div class="settings" id="settingsContainerDiv"></div>
        <button id="set">Set</button>
    </article>
    <script>
        $(document).ready(function() {
            document.getElementById('setButton').onclick = function() {
                NetworkTables.setValue(document.getElementById('name').value,
                    document.getElementById("value").value);
            };
            document.getElementById("get").onclick = function() {
                    document.getElementById('value').value = NetworkTables.getValue(
                        document.getElementById("name").value);
                }
                // sets a function that will be called when the websocket connects/disconnects
            NetworkTables.addWsConnectionListener(onNetworkTablesConnection, true);

            // sets a function that will be called when the robot connects/disconnects
            NetworkTables.addRobotConnectionListener(onRobotConnection, true);

            // sets a function that will be called when any NetworkTables key/value changes
            NetworkTables.addGlobalListener(onValueChanged, true);
        });
        // called when the websocket connects/disconnects
        function onRobotConnection(connected) { // TODO: change some indicator
            console.log("Robot connected: " + connected);
        }

        function onNetworkTablesConnection(connected) {
            // TODO: change some indicator
        }

        function onValueChanged(key, value, isNew) {
            console.log(key, value, isNew);
            //name, data, has the variable just been created t/f

            // key thing here: we're using the various NetworkTable keys as
            // the id of the elements that we're appending, for simplicity. However,
            // the key names aren't always valid HTML identifiers, so we use
            // the NetworkTables.keyToId() function to convert them appropriately
            if (isNew) {
                var div = $('<div></div>').appendTo($('.settings'));
                $('<p></p>').text(key).appendTo(div);
                if (value === true || value === false) {
                    var boolSlider = $("<div class='bool-slider " + value + "'></div>");
                    var innerInset = $('<div class="inset" ></div>');
                    innerInset.append('<div class="control"></div>')
                        .click(function() {
                            if (boolSlider.hasClass('true')) {
                                NetworkTables.setValue(key, false);
                                boolSlider.addClass('false').removeClass('true');
                            } else {
                                NetworkTables.setValue(key, true);
                                boolSlider.addClass('true').removeClass('false');
                            }
                        });
                    innerInset.appendTo(boolSlider);
                    boolSlider.appendTo(div);
                } else if (!isNaN(value)) {
                    if (!isNaN(value)) {
                        $('<input type="number">')
                            .attr('id', NetworkTables.keyToId(key))
                            .attr('value', value)
                            .appendTo(div);
                    }
                  }else {
                        $('<input type="text">')
                            .attr('id', NetworkTables.keyToId(key))
                            .attr('value', value)
                            .appendTo(div);
                    }

                /*else {
                                // similarly, use keySelector to convert the key to a valid jQuery
                                // selector. This should work for class names also, not just for ids
                                //$('#' + NetworkTables.keySelector(key)).text(value);
                            }*/
            }
          }
            $('#set').click(function() {
                var childInputs = $('#settingsContainerDiv input');
                childInputs.each(function(a) {

                    var thisChild = $(this);
                    NetworkTables.setValue(thisChild.attr('id'), thisChild.val());
                });
            });

    </script>
</body>

</html>
